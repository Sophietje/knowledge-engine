services:
  # This is the knowledge directory, facilitating discovery between different
  # runtimes. It exposes its service over port 8282.
  knowledge-directory:
    image: docker-registry.inesctec.pt/interconnect/knowledge-engine/knowledge-directory:1.1.3

  # These two services are separate Knowledge Engine runtime, which can host
  # multiple smart connectors. Note that the REST API port is a DIFFERENT port
  # number than the ones configured below. It is still the default 8280.
  runtime-1:
    image: docker-registry.inesctec.pt/interconnect/knowledge-engine/smart-connector-rest-dist:1.1.3
    environment: 
      KE_RUNTIME_PORT: 8081 # The port that the KE uses to listen for inter-KE-runtime communication.
      KE_RUNTIME_EXPOSED_URL: http://runtime-1:8081 # The URL where the runtime is available for inter-runtime communication from the outside.
      KD_URL: http://knowledge-directory:8282
    ports:
      - 8280:8280
  runtime-2:
    image: docker-registry.inesctec.pt/interconnect/knowledge-engine/smart-connector-rest-dist:1.1.3
    environment: 
      KE_RUNTIME_PORT: 8081 # The port that the KE uses to listen for inter-KE-runtime communication.
      KE_RUNTIME_EXPOSED_URL: http://runtime-2:8081 # The URL where the runtime is available for inter-runtime communication from the outside.
      KD_URL: http://knowledge-directory:8282
    ports:
      - 8281:8280
  
  # The example script is a JavaScript/TypeScript application that sets up a KB
  # in each runtime, and lets them exchange knowledge.
  knowledge-exchange-script:
    build: ./knowledge-exchange-script
